<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AudiThor - Security Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-stacked100@1.0.0"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body class="text-[#204071]">
    <div id="main-app-view" class="h-screen">
        <div class="flex h-full">
            <aside class="w-64 bg-[#204071] text-white flex flex-col fixed h-full">
                <div class="flex items-center justify-center p-4 border-b border-[#1a335a] space-x-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="h-10 w-10 text-[#eb3496]" viewBox="0 0 16 16">
                        <path d="M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641zM6.374 1 4.168 8.5H7.5a.5.5 0 0 1 .478.647L6.78 13.04 11.478 7H8a.5.5 0 0 1-.474-.658L9.306 1z"/>
                    </svg>
                    <h1 class="text-2xl font-bold text-white">AudiThor</h1>
                </div>
                <nav id="sidebar-nav" class="flex-1 mt-4 px-2 space-y-4 overflow-y-auto">
                    <div><a href="#" data-view="iam" class="main-nav-link flex items-center px-4 py-2.5 rounded-md bg-[#eb3496]"><span>Identity & Access</span></a></div>
                    <div><a href="#" data-view="exposure" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>Internet Exposure</span></a></div>
                    <div><a href="#" data-view="guardduty" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>GuardDuty</span></a></div>
                    <div><a href="#" data-view="waf" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>WAF</span></a></div>
                    <div><a href="#" data-view="cloudtrail" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>CloudTrail</span></a></div>
                    <div><a href="#" data-view="cloudwatch" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>Cloudwatch & SNS</span></a></div>
                    <div><a href="#" data-view="inspector" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>Inspector</span></a></div>
                    <div><a href="#" data-view="acm" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>ACM</span></a></div>
                    <div><a href="#" data-view="compute" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>Compute</span></a></div>
                    <div><a href="#" data-view="ecr" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>ECR</span></a></div>
                    <div><a href="#" data-view="databases" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>Databases</span></a></div>
                    <div><a href="#" data-view="kms" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>KMS & Secrets</span></a></div>
                    <div><a href="#" data-view="network-policies" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>Network Policies</span></a></div>
                    <div><a href="#" data-view="connectivity" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>Network Connectivity</span></a></div>
                    <div><a href="#" data-view="config-sh" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>Config & SecurityHub</span></a></div>
                    <div><a href="#" data-view="codepipeline" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>CodePipeline</span></a></div>
                    <div><a href="#" data-view="playground" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>Playground</span></a></div>
                    <div><a href="#" data-view="healthy-status" class="main-nav-link flex items-center px-4 py-2.5 rounded-md hover:bg-[#1a335a]"><span>Healthy Status</span></a></div>
                </nav>
            </aside>

            <div id="view-container" class="flex-1 ml-64 p-6 lg:p-8 bg-gray-50">
                <div class="bg-white/80 backdrop-blur-sm border border-gray-200 p-4 rounded-xl shadow-md mb-6 sticky top-6 z-10">
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 items-end">
                        <div><label for="access-key-input" class="block text-sm font-medium text-[#204071] mb-1">AWS Access Key ID</label><input type="text" id="access-key-input" class="bg-gray-50 border border-gray-300 text-[#204071] text-sm rounded-lg focus:ring-[#eb3496] focus:border-[#eb3496] block w-full p-2.5" placeholder="AKIA..."></div>
                        <div><label for="secret-key-input" class="block text-sm font-medium text-[#204071] mb-1">AWS Secret Access Key</label><input type="password" id="secret-key-input" class="bg-gray-50 border border-gray-300 text-[#204071] text-sm rounded-lg focus:ring-[#eb3496] focus:border-[#eb3496] block w-full p-2.5" placeholder="••••••••••••••••"></div>
                        <div><label for="session-token-input" class="block text-sm font-medium text-[#204071] mb-1">AWS Session Token (Optional)</label><input type="password" id="session-token-input" class="bg-gray-50 border border-gray-300 text-[#204071] text-sm rounded-lg focus:ring-[#eb3496] focus:border-[#eb3496] block w-full p-2.5" placeholder="Session token (if necessary)"></div>
                        <div class="flex items-center"><div class="flex items-center space-x-2"><button id="run-analysis-button" class="w-full bg-[#eb3496] text-white px-4 py-2.5 rounded-lg font-bold text-md hover:bg-[#d42c86] transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"><span id="button-text">Scan Account</span><div id="loading-spinner" class="spinner hidden"></div></button><button id="import-results-button" title="Import results from JSON" class="w-auto bg-gray-600 text-white p-2.5 rounded-lg hover:bg-gray-700 transition"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upload w-5 h-5" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/><path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"/></svg></button><input type="file" id="json-file-input" class="hidden" accept="application/json"><button id="export-results-button" title="Export results to JSON" class="w-auto bg-[#204071] text-white p-2.5 rounded-lg hover:bg-[#1a335a] transition"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download w-5 h-5" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/><path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/></svg></button></div></div>
                    </div>
                    <div id="error-message" class="text-red-600 text-sm mt-2 font-medium hidden"></div>
                </div>

                <main id="healthy-status-view" class="view"></main>
                <main id="iam-view" class="view hidden"></main>
                <main id="exposure-view" class="view hidden"></main>
                <main id="guardduty-view" class="view hidden"></main>
                <main id="waf-view" class="view hidden"></main>
                <main id="cloudtrail-view" class="view hidden"></main>
                <main id="cloudwatch-view" class="view hidden"></main>
                <main id="inspector-view" class="view hidden"></main>
                <main id="acm-view" class="view hidden"></main>
                <main id="compute-view" class="view hidden"></main>
                <main id="ecr-view" class="view hidden"></main>
                <main id="databases-view" class="view hidden"></main>
                <main id="kms-view" class="view hidden"></main>
                <main id="network-policies-view" class="view hidden"></main>
                <main id="connectivity-view" class="view hidden"></main>
                <main id="config-sh-view" class="view hidden"></main>
                <main id="codepipeline-view" class="view hidden"></main>
                <main id="playground-view" class="view hidden"></main>
            </div>
        </div>
    </div>

    <!-- Event Log Panel Mejorado -->
    <div id="log-panel" class="fixed bottom-0 right-0 w-full md:w-1/3 h-64 bg-[#1a2b47] text-white rounded-t-lg shadow-2xl p-4 flex flex-col z-50">
        <!-- Icono flotante (solo visible cuando está minimizado) -->
        <div id="floating-icon" title="Click to open Event Log">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-bar-graph" viewBox="0 0 16 16">
                <path d="M4.5 12a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5zm3 0a.5.5 0 0 1-.5-.5v-4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5zm3 0a.5.5 0 0 1-.5-.5v-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-.5.5z"/>
                <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1"/>
            </svg>
        </div>
        
        <!-- Contenido normal del panel -->
        <div class="log-panel-content">
            <div class="flex justify-between items-center mb-2">
                <h4 class="font-bold text-slate-300">Event Log</h4>
                <div>
                    <button id="clear-log-btn" class="text-xs bg-[#2f5a9e] hover:bg-[#204071] px-2 py-1 rounded mr-1">Clear</button>
                    <button id="toggle-log-btn" class="text-xs bg-[#2f5a9e] hover:bg-[#204071] px-2 py-1 rounded">Minimize</button>
                </div>
            </div>
            <div id="log-container" class="flex-1 bg-slate-900 p-2 rounded overflow-y-auto text-xs space-y-1"></div>
        </div>
    </div>

    <div id="details-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-xl shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <div class="flex justify-between items-center mb-4 pb-3 border-b">
                    <h3 id="modal-title" class="text-xl leading-6 font-bold text-[#204071]">Details</h3>
                    <button id="modal-close-btn" class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                </div>
                <div id="modal-content" class="mt-2 px-7 py-3"></div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/constants.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/app.js') }}"></script>

</body>
</html>